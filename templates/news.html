{% extends "base.html" %}

{% block title %}Tin T·ª©c - BuddySkincare{% endblock %}

{% block extra_css %}
<style>
    .news-container { 
        background: #ffffff; 
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
        color: #374151; 
        max-width: 100%; 
        margin: 0 auto; 
        padding: 0; 
    }

    /* Hero */
    .hero { position: relative; padding: 2rem 0 1.5rem; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; overflow: hidden; width: 100%; }
    .hero-content { position: relative; z-index: 2; max-width: 860px; margin: 0 auto; padding: 0 2rem; }
    .hero h1 { font-size: 3rem; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 1rem; text-shadow: 0 4px 8px rgba(0,0,0,0.3); }
    .hero p { font-size: 1.1rem; color: rgba(255,255,255,0.9); margin: 0 auto; max-width: 700px; }

    /* Layout */
    .content-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem; max-width: 1200px; margin-left: auto; margin-right: auto; padding: 0 1rem; }

    /* Filters */
    .filters { display: grid; grid-template-columns: 1fr 280px; gap: 0.75rem; margin-bottom: 1rem; }
    .search { position: relative; }
    .search input { width: 100%; border: 1px solid #e5e7eb; border-radius: 10px; padding: 0.65rem 2.6rem 0.65rem 0.75rem; font-size: 0.95rem; }
    .search .icon { position: absolute; right: 0.6rem; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 1rem; line-height: 1; height: 1rem; display: inline-flex; align-items: center; pointer-events: none; }
    .categories { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .chip { border: 1px solid #e5e7eb; border-radius: 999px; padding: 0.4rem 0.8rem; font-size: 0.9rem; background: #fff; cursor: pointer; }
    .chip.active { background: #111827; border-color: #111827; color: #fff; }

    /* Article list */
    .articles { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }
    .article { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; overflow: hidden; transition: all 0.3s ease; display: flex; flex-direction: column; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
    .article:hover { border-color: #667eea; box-shadow: 0 12px 28px rgba(102, 126, 234, 0.15); transform: translateY(-2px); }
    .thumb { position: relative; aspect-ratio: 16/10; background: #f8fafc; overflow: hidden; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.3s ease; }
    .article:hover .thumb img { transform: scale(1.05); }
    .article .badge { position: absolute; left: 12px; top: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border-radius: 20px; padding: 0.3rem 0.8rem; font-size: 0.75rem; font-weight: 600; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); }
    .content { padding: 1.2rem 1.5rem 1.5rem; display: flex; flex-direction: column; gap: 0.6rem; }
    .title { font-size: 1.1rem; font-weight: 700; color: #1e293b; margin: 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .meta { display: flex; align-items: center; gap: 1rem; font-size: 0.8rem; color: #64748b; margin-bottom: 0.3rem; flex-wrap: wrap; }
    .meta span { display: flex; align-items: center; gap: 0.3rem; }
    .meta i { color: #9ca3af; font-size: 0.75rem; }
    .excerpt { font-size: 0.9rem; color: #475569; line-height: 1.6; margin-top: 0.3rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .read-more { 
        margin-top: 1rem; 
        display: inline-flex; 
        align-items: center; 
        gap: 0.5rem; 
        font-weight: 600; 
        color: #667eea; 
        font-size: 0.85rem; 
        padding: 0.5rem 1rem; 
        border: 2px solid #667eea; 
        border-radius: 25px; 
        text-decoration: none; 
        transition: all 0.3s ease; 
        background: transparent; 
        align-self: flex-start;
    }
    .read-more:hover { 
        background: #667eea; 
        color: #fff; 
        text-decoration: none; 
        transform: translateY(-1px); 
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25); 
    }
    .read-more i { 
        transition: transform 0.3s ease; 
        font-size: 0.75rem;
    }
    .read-more:hover i { 
        transform: translateX(2px); 
    }

    /* Sidebar */
    .sidebar-section { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
    .sidebar-title { font-size: 1rem; font-weight: 800; color: #111827; margin-bottom: 0.6rem; }
    .list { list-style: none; padding: 0; margin: 0; }
    .list li { display: flex; gap: 0.5rem; padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6; }
    .list li:last-child { border-bottom: 0; }
    .list a { color: #374151; text-decoration: none; font-size: 0.95rem; }
    .list a:hover { color: #111827; text-decoration: underline; }

    .newsletter { background: linear-gradient(135deg, #ede9fe, #eef2ff); border: 1px solid #ddd6fe; border-radius: 12px; padding: 1rem; }
    .newsletter input { width: 100%; border: 1px solid #ddd6fe; border-radius: 10px; padding: 0.6rem 0.75rem; font-size: 0.95rem; margin-top: 0.5rem; }
    .btn-primary { background: #6d28d9; color: #fff; border: none; border-radius: 10px; padding: 0.6rem 0.9rem; font-weight: 700; font-size: 0.9rem; margin-top: 0.6rem; }

    /* Responsive */
    @media (max-width: 768px) {
        .hero { padding: 1.5rem 0 1rem; }
        .hero h1 { font-size: 2rem; }
        .hero p { font-size: 0.95rem; }
        .content-layout { grid-template-columns: 1fr; gap: 1.5rem; }
        .filters { grid-template-columns: 1fr; }
        .articles { grid-template-columns: 1fr; gap: 1rem; }
        .article { border-radius: 12px; }
        .content { padding: 1rem 1.2rem 1.2rem; }
        .title { font-size: 1rem; }
        .meta { gap: 0.8rem; font-size: 0.75rem; }
        .excerpt { font-size: 0.85rem; }
        .read-more { font-size: 0.8rem; padding: 0.4rem 0.8rem; }
    }
    
    @media (max-width: 480px) {
        .articles { grid-template-columns: 1fr; }
        .content { padding: 0.8rem 1rem 1rem; }
        .title { font-size: 0.95rem; }
        .meta { flex-direction: column; align-items: flex-start; gap: 0.3rem; }
        .excerpt { font-size: 0.8rem; }
        .read-more { font-size: 0.75rem; padding: 0.35rem 0.7rem; }
    }

    /* Pagination Styles */
    .pagination {
        margin: 0;
        gap: 0.25rem;
    }
    
    .pagination .page-item {
        margin: 0;
    }
    
    .pagination .page-link {
        border: 1px solid #e5e7eb;
        color: #6b7280;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        border-radius: 8px;
        transition: all 0.2s ease;
        text-decoration: none;
    }
    
    .pagination .page-link:hover {
        background-color: #f3f4f6;
        border-color: #d1d5db;
        color: #374151;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #667eea;
        border-color: #667eea;
        color: #fff;
    }
    
    .pagination .page-item.disabled .page-link {
        background-color: #f9fafb;
        border-color: #e5e7eb;
        color: #9ca3af;
        cursor: not-allowed;
    }
    
    .pagination .page-item.disabled .page-link:hover {
        background-color: #f9fafb;
        border-color: #e5e7eb;
        color: #9ca3af;
    }
    
    /* Mobile pagination */
    @media (max-width: 768px) {
        .pagination .page-link {
            padding: 0.375rem 0.5rem;
            font-size: 0.8rem;
        }
        
        /* Show all pagination items on mobile for now */
        .pagination .page-item .page-link {
            display: block;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="news-container">
    <section class="hero">
        <div class="hero-content">
            <h1>Tin T·ª©c & B√†i Vi·∫øt</h1>
            <p>C·∫≠p nh·∫≠t xu h∆∞·ªõng l√†m ƒë·∫πp, m·∫πo ch·ªçn m·ªπ ph·∫©m thanh l√Ω/pass tester v√† ∆∞u ƒë√£i m·ªõi nh·∫•t t·ª´ BuddySkincare.</p>
        </div>
    </section>

    <div class="content-layout">
        <div class="main-content">
            <div class="filters">
                <div class="categories">
                    <button class="chip active" data-cat="all">T·∫•t c·∫£</button>
                    <button class="chip" data-cat="guide">H∆∞·ªõng d·∫´n</button>
                    <button class="chip" data-cat="deal">∆Øu ƒë√£i</button>
                    <button class="chip" data-cat="tips">M·∫πo l√†m ƒë·∫πp</button>
                </div>
                <div class="search">
                    <input id="searchInput" type="text" placeholder="T√¨m ki·∫øm b√†i vi·∫øt...">
                </div>
            </div>

            <div id="articleList" class="articles">
                <!-- Loading state -->
                <div id="loadingState" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">ƒêang t·∫£i...</span>
                    </div>
                    <p class="mt-3 text-muted">ƒêang t·∫£i b√†i vi·∫øt...</p>
                    </div>
                
                <!-- Error state -->
                <div id="errorState" class="text-center py-5" style="display: none;">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h5>Kh√¥ng th·ªÉ t·∫£i b√†i vi·∫øt</h5>
                    <p class="text-muted">Vui l√≤ng th·ª≠ l·∫°i sau ho·∫∑c li√™n h·ªá h·ªó tr·ª£.</p>
                    <button class="btn btn-primary" onclick="loadBlogPosts()">Th·ª≠ l·∫°i</button>
                    </div>
                
                <!-- Empty state -->
                <div id="emptyState" class="text-center py-5" style="display: none;">
                    <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                    <h5>Ch∆∞a c√≥ b√†i vi·∫øt n√†o</h5>
                    <p class="text-muted">H√£y quay l·∫°i sau ƒë·ªÉ xem nh·ªØng b√†i vi·∫øt m·ªõi nh·∫•t.</p>
                    </div>
            </div>

            <!-- Debug Test Button (Hidden - no pagination needed) -->
            <div class="text-center mb-3" style="display: none;">
                <button class="btn btn-warning btn-sm" onclick="testPagination()">
                    üîç Test Pagination
                </button>
                <button class="btn btn-info btn-sm ms-2" onclick="testSimplePagination()">
                    üîç Simple Test
                </button>
            </div>

            <!-- Pagination -->
            <div id="paginationContainer" class="d-flex justify-content-center my-4" style="display: none;">
                <nav aria-label="pagination">
                    <ul id="paginationList" class="pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </ul>
                </nav>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">B√†i Vi·∫øt M·ªõi</div>
                <ul class="list">
                    <li><a href="/flash-sale">Flash Sale gi·ªù v√†ng: c√°ch sƒÉn deal hi·ªáu qu·∫£</a></li>
                    <li><a href="/shopping-guide">H∆∞·ªõng d·∫´n thanh l√Ω h·ªô chi ti·∫øt</a></li>
                    <li><a href="/online-payment-safety">5 b∆∞·ªõc ki·ªÉm tra chuy·ªÉn kho·∫£n an to√†n</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Danh M·ª•c</div>
                <ul class="list">
                    <li><a href="#" data-cat="guide">H∆∞·ªõng d·∫´n</a></li>
                    <li><a href="#" data-cat="deal">∆Øu ƒë√£i</a></li>
                    <li><a href="#" data-cat="tips">M·∫πo l√†m ƒë·∫πp</a></li>
                </ul>
            </div>
            <div class="sidebar-section newsletter">
                <div class="sidebar-title">Nh·∫≠n B·∫£n Tin</div>
                <div class="small">Nh·∫≠p email ƒë·ªÉ nh·∫≠n tin ∆∞u ƒë√£i m·ªõi nh·∫•t.</div>
                <input id="newsEmail" type="email" placeholder="email@domain.com">
                <button class="btn-primary" onclick="subscribeNews()">ƒêƒÉng k√Ω</button>
            </div>
        </div>
    </div>
</div>

<script>
// Global variables
let allBlogPosts = [];
let filteredPosts = [];
let currentPage = 1;
let totalPages = 1;
let paginationData = null;

// Blog tag mapping - matches BLOG_TAG_CHOICES from models
const tagMapping = {
    'HD': 'guide',    // H∆∞·ªõng d·∫´n
    'UD': 'deal',     // ∆Øu ƒë√£i
    'MLD': 'tips'     // M·∫πo l√†m ƒë·∫πp
};

// Load blog posts from API
async function loadBlogPosts(page = 1) {
    const loadingState = document.getElementById('loadingState');
    const errorState = document.getElementById('errorState');
    const emptyState = document.getElementById('emptyState');
    const articleList = document.getElementById('articleList');
    
    // Show loading state
    loadingState.style.display = 'block';
    errorState.style.display = 'none';
    emptyState.style.display = 'none';
    
    try {
        // Load all posts without pagination
        const response = await fetch('https://buddyskincare.pythonanywhere.com/blog/');
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        let posts = data.results || data;
        
        // If there are multiple pages, load all of them
        if (data.next) {
            console.log('üîç Multiple pages detected, loading all posts...');
            let allPosts = [...posts];
            let nextUrl = data.next;
            
            while (nextUrl) {
                try {
                    const nextResponse = await fetch(nextUrl);
                    if (nextResponse.ok) {
                        const nextData = await nextResponse.json();
                        allPosts = [...allPosts, ...(nextData.results || [])];
                        nextUrl = nextData.next;
                        console.log(`üîç Loaded page ${nextData.current_page || 'unknown'}, total posts: ${allPosts.length}`);
                    } else {
                        break;
                    }
                } catch (error) {
                    console.error('Error loading additional page:', error);
                    break;
                }
            }
            
            posts = allPosts;
            console.log(`‚úÖ Loaded all posts: ${posts.length} total`);
        }
        
        if (!posts || posts.length === 0) {
            showEmptyState();
            return;
        }
        
        // Store all posts (no pagination needed)
        allBlogPosts = posts;
        filteredPosts = [...posts];
        
        console.log('üîç loadBlogPosts - all posts loaded:');
        console.log('üìä Total posts:', posts.length);
        console.log('üìù First post title:', posts[0]?.title || 'N/A');
        
        renderBlogPosts(posts);
        
        // Hide pagination since we're showing all posts
        const paginationContainer = document.getElementById('paginationContainer');
        if (paginationContainer) {
            paginationContainer.style.display = 'none';
            console.log('‚úÖ Pagination hidden - showing all posts');
        }
        
        // Initialize filters
        setTimeout(() => {
            console.log('üîç Initializing filters');
            initializeFilters();
        }, 100);
        
    } catch (error) {
        console.error('Error loading blog posts:', error);
        showErrorState();
    }
}

// Show error state
function showErrorState() {
    document.getElementById('loadingState').style.display = 'none';
    document.getElementById('errorState').style.display = 'block';
    document.getElementById('emptyState').style.display = 'none';
}

// Show empty state
function showEmptyState() {
    document.getElementById('loadingState').style.display = 'none';
    document.getElementById('errorState').style.display = 'none';
    document.getElementById('emptyState').style.display = 'block';
}

// Render blog posts
function renderBlogPosts(posts) {
    const articleList = document.getElementById('articleList');
    const loadingState = document.getElementById('loadingState');
    const errorState = document.getElementById('errorState');
    const emptyState = document.getElementById('emptyState');
    
    // Hide states
    loadingState.style.display = 'none';
    errorState.style.display = 'none';
    emptyState.style.display = 'none';
    
    if (!posts || posts.length === 0) {
        showEmptyState();
        return;
    }
    
    const postsHTML = posts.map(post => createBlogPostHTML(post)).join('');
    articleList.innerHTML = postsHTML;
    
    // Don't initialize filters here - it's done after renderPagination
}

// Create HTML for a blog post
function createBlogPostHTML(post) {
    const imageUrl = post.img_thumbnail || '/static/image/default-blog.jpg';
    const tag = tagMapping[post.tag] || 'guide';
    const tagText = getTagText(post.tag);
    const postDate = formatDateTime(post.post_date);
    const excerpt = truncateText(post.short_description, 150);
    const readTime = estimateReadTime(post.content);
    const views = post.views || 0;
    
    return `
        <article class="article" data-cat="${tag}">
            <a href="/blog/${post.id}" style="text-decoration: none; color: inherit;">
                <div class="thumb" style="cursor: pointer;">
                    <img src="${imageUrl}" alt="${post.title}" onerror="this.src='/static/image/default-blog.jpg'">
                    <span class="badge">${tagText}</span>
                </div>
            </a>
            <div class="content">
                <a href="/blog/${post.id}" style="text-decoration: none; color: inherit;">
                    <h3 class="title" style="cursor: pointer;">${post.title}</h3>
                </a>
                <div class="meta">
                    <span><i class="fas fa-calendar-alt"></i> ${postDate}</span>
                    <span><i class="fas fa-eye"></i> ${views} l∆∞·ª£t xem</span>
                    <span><i class="fas fa-clock"></i> ${readTime} ph√∫t</span>
                </div>
                <p class="excerpt">${excerpt}</p>
                <a class="read-more" href="/blog/${post.id}">
                    ƒê·ªçc ti·∫øp <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </article>
    `;
}

// Get tag text - matches BLOG_TAG_CHOICES from models
function getTagText(tag) {
    const tagTexts = {
        'HD': 'H∆∞·ªõng d·∫´n',
        'UD': '∆Øu ƒë√£i',
        'MLD': 'M·∫πo l√†m ƒë·∫πp'
    };
    return tagTexts[tag] || 'B√†i vi·∫øt';
}

// Format date with time
function formatDateTime(dateString) {
    try {
        const date = new Date(dateString);
        const time = date.toLocaleTimeString('vi-VN', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        });
        const dateStr = date.toLocaleDateString('vi-VN', {
            day: '2-digit',
            month: '2-digit', 
            year: 'numeric'
        });
        return `${time} ${dateStr}`;
    } catch (error) {
        return 'Kh√¥ng r√µ ng√†y';
    }
}

// Truncate text
function truncateText(text, maxLength) {
    if (!text) return '';
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength).trim() + '...';
}

// Estimate read time
function estimateReadTime(content) {
    if (!content) return 2;
    const wordsPerMinute = 200;
    const wordCount = content.replace(/<[^>]*>/g, '').split(/\s+/).length;
    return Math.max(1, Math.ceil(wordCount / wordsPerMinute));
}

// Initialize filters
function initializeFilters() {
    const chips = document.querySelectorAll('.chip');
    const searchInput = document.getElementById('searchInput');
    const items = document.querySelectorAll('.article');

    function applyFilters() {
        const activeChip = document.querySelector('.chip.active');
        const cat = activeChip ? activeChip.getAttribute('data-cat') : 'all';
        const q = (searchInput.value || '').toLowerCase().trim();
        

        items.forEach(it => {
            const inCat = (cat === 'all') || it.getAttribute('data-cat').includes(cat);
            const text = it.innerText.toLowerCase();
            const match = !q || text.includes(q);
            it.style.display = (inCat && match) ? '' : 'none';
        });
        
        // Hide pagination since we're showing all posts
        const paginationContainer = document.getElementById('paginationContainer');
        if (paginationContainer) {
            paginationContainer.style.display = 'none';
            console.log('‚úÖ Pagination hidden - showing all posts without pagination');
        }
    }

    chips.forEach(chip => chip.addEventListener('click', () => {
        chips.forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        applyFilters();
    }));

    searchInput.addEventListener('input', applyFilters);
    applyFilters();
}

// Render pagination
function renderPagination() {
    console.log('üîç renderPagination called');
    console.log('üìä paginationData:', paginationData);
    console.log('üìÑ totalPages:', totalPages);
    
    try {
        const paginationContainer = document.getElementById('paginationContainer');
        const paginationList = document.getElementById('paginationList');
        
        console.log('üì¶ paginationContainer:', paginationContainer);
        console.log('üì¶ paginationList:', paginationList);
        
        if (!paginationContainer || !paginationList) {
            console.log('‚ùå Missing pagination elements');
            return;
        }
        
        if (!paginationData || totalPages <= 1) {
            console.log('‚ùå No pagination data or only 1 page');
            paginationContainer.style.display = 'none';
            return;
        }
    } catch (error) {
        console.error('‚ùå Error in renderPagination:', error);
        return;
    }
    
    console.log('‚úÖ Showing pagination');
    paginationContainer.style.display = 'flex';
    paginationList.innerHTML = '';
    
    console.log('üîç Creating pagination elements...');
    
    // Previous button
    const prevLi = document.createElement('li');
    prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
    const prevLink = document.createElement('a');
    prevLink.className = 'page-link';
    prevLink.href = '#';
    prevLink.innerHTML = '¬´';
    prevLink.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('üîç Previous button clicked');
        if (currentPage > 1) {
            console.log('üîç Loading page:', currentPage - 1);
            loadBlogPosts(currentPage - 1);
        }
    });
    prevLi.appendChild(prevLink);
    paginationList.appendChild(prevLi);
    
    console.log('‚úÖ Added previous button');
    
    // Page numbers
    const startPage = Math.max(1, currentPage - 2);
    const endPage = Math.min(totalPages, currentPage + 2);
    
    console.log(`üîç Page range: ${startPage} to ${endPage}`);
    
    // First page if not in range
    if (startPage > 1) {
        const firstLi = createPageItem(1);
        paginationList.appendChild(firstLi);
        console.log('‚úÖ Added first page');
        
        if (startPage > 2) {
            const ellipsisLi = document.createElement('li');
            ellipsisLi.className = 'page-item disabled';
            ellipsisLi.innerHTML = '<span class="page-link">...</span>';
            paginationList.appendChild(ellipsisLi);
            console.log('‚úÖ Added ellipsis');
        }
    }
    
    // Page range
    for (let i = startPage; i <= endPage; i++) {
        const pageLi = createPageItem(i);
        paginationList.appendChild(pageLi);
        console.log(`‚úÖ Added page ${i}`);
    }
    
    // Last page if not in range
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const ellipsisLi = document.createElement('li');
            ellipsisLi.className = 'page-item disabled';
            ellipsisLi.innerHTML = '<span class="page-link">...</span>';
            paginationList.appendChild(ellipsisLi);
        }
        
        const lastLi = createPageItem(totalPages);
        paginationList.appendChild(lastLi);
    }
    
    // Next button
    const nextLi = document.createElement('li');
    nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
    const nextLink = document.createElement('a');
    nextLink.className = 'page-link';
    nextLink.href = '#';
    nextLink.innerHTML = '¬ª';
    nextLink.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('üîç Next button clicked');
        if (currentPage < totalPages) {
            console.log('üîç Loading page:', currentPage + 1);
            loadBlogPosts(currentPage + 1);
        }
    });
    nextLi.appendChild(nextLink);
    paginationList.appendChild(nextLi);
    
    console.log('‚úÖ Added next button');
    console.log('üîç Final pagination HTML:', paginationList.innerHTML);
}

// Create page item
function createPageItem(pageNum) {
    const li = document.createElement('li');
    li.className = `page-item ${pageNum === currentPage ? 'active' : ''}`;
    
    const link = document.createElement('a');
    link.className = 'page-link';
    link.href = '#';
    link.textContent = pageNum;
    link.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('üîç Page button clicked:', pageNum);
        if (pageNum !== currentPage) {
            console.log('üîç Loading page:', pageNum);
            loadBlogPosts(pageNum);
        } else {
            console.log('üîç Already on page:', pageNum);
        }
    });
    
    li.appendChild(link);
    return li;
}

// Newsletter subscription
function subscribeNews() {
    const input = document.getElementById('newsEmail');
    const val = (input.value || '').trim();
    if (!val) { 
        alert('Vui l√≤ng nh·∫≠p email.'); 
        return; 
    }
    
    // Call newsletter API
    fetch('/api/newsletter', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email: val })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ƒêƒÉng k√Ω b·∫£n tin th√†nh c√¥ng!');
    input.value = '';
        } else {
            alert(data.message || 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.');
        }
    })
    .catch(error => {
        console.error('Newsletter subscription error:', error);
        alert('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.');
    });
}


// Test pagination function
function testPagination() {
    console.log('üîç TEST PAGINATION CLICKED');
    console.log('üìä Current paginationData:', paginationData);
    console.log('üìÑ Current totalPages:', totalPages);
    console.log('üìÑ Current currentPage:', currentPage);
    
    const paginationContainer = document.getElementById('paginationContainer');
    const paginationList = document.getElementById('paginationList');
    
    console.log('üì¶ paginationContainer:', paginationContainer);
    console.log('üì¶ paginationList:', paginationList);
    console.log('üì¶ paginationContainer display:', paginationContainer ? paginationContainer.style.display : 'N/A');
    
    if (paginationData && totalPages > 1) {
        console.log('‚úÖ Forcing pagination display');
        paginationContainer.style.display = 'flex';
        console.log('üîç Calling renderPagination()...');
        renderPagination();
        console.log('üîç renderPagination() completed');
    } else {
        console.log('‚ùå No pagination data or only 1 page');
    }
}

// Simple test pagination function
function testSimplePagination() {
    console.log('üîç SIMPLE TEST PAGINATION CLICKED');
    
    const paginationContainer = document.getElementById('paginationContainer');
    const paginationList = document.getElementById('paginationList');
    
    console.log('üì¶ paginationContainer:', paginationContainer);
    console.log('üì¶ paginationList:', paginationList);
    
    if (paginationContainer && paginationList) {
        console.log('‚úÖ Elements found, creating simple pagination...');
        paginationContainer.style.display = 'flex';
        paginationList.innerHTML = `
            <li class="page-item disabled">
                <span class="page-link">¬´</span>
            </li>
            <li class="page-item active">
                <span class="page-link">1</span>
            </li>
            <li class="page-item">
                <a class="page-link" href="#" onclick="event.preventDefault(); loadBlogPosts(2); return false;">2</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="#" onclick="event.preventDefault(); loadBlogPosts(2); return false;">¬ª</a>
            </li>
        `;
        console.log('‚úÖ Simple pagination created');
        console.log('üì¶ Final HTML:', paginationList.innerHTML);
    } else {
        console.log('‚ùå Elements not found');
    }
}

// Load blog posts when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadBlogPosts();
});
</script>
{% endblock %}