{% extends "base.html" %}

{% block title %}BuddySkincare - Mỹ Phẩm Thanh Lý Giá Tốt Nhất{% endblock %}

{% block content %}
<style>
    /* Responsive hero banner heights to avoid clipping on small screens */
    @media (max-width: 992px) {
        .hero-banner .carousel-item img { height: 380px !important; }
    }
    @media (max-width: 768px) {
        .hero-banner .carousel-item img { height: 300px !important; }
    }
    @media (max-width: 576px) {
        .hero-banner .carousel-item img { height: 220px !important; }
        .hero-banner .carousel-indicators { bottom: 6px; }
        .hero-banner .carousel-control-prev, .hero-banner .carousel-control-next { width: 12%; }
        .hero-banner { margin-bottom: 15px; }
    }
    @media (max-width: 360px) {
        .hero-banner .carousel-item img { height: 200px !important; }
    }
</style>
<!-- Hero Banner -->
<section class="hero-banner">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{{ url_for('static', filename='image/sukien/banner01.png') }}" class="d-block w-100" alt="Banner 1" style="height: 520px; object-fit: cover;">
            </div>
            <div class="carousel-item">
                <img src="{{ url_for('static', filename='image/sukien/banner02.png') }}" class="d-block w-100" alt="Banner 1" style="height: 520px; object-fit: cover;">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

</section>

<!-- Flash Sale Section -->
<section class="flash-sale section-padding">
    <div class="container">
        <style>
            .flash-sale-wrapper{background:linear-gradient(135deg,#fff7f7 0%,#ffe9e9 100%);border-radius:18px;padding:18px 16px;box-shadow:0 10px 30px rgba(68, 68, 68, 0.139);position:relative;overflow:hidden}
            .flash-sale-ribbon{position:absolute;top:22px;left:-38px;transform:rotate(-30deg);background:#ff4d4f;color:#fff;padding:6px 48px;font-weight:700;letter-spacing:.5px;border-radius:6px;box-shadow:0 6px 16px rgba(255,77,79,.35);font-size:12px;z-index:0;pointer-events:none}
            .flash-sale-header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:20px}
            .flash-sale-title{display:flex;align-items:center;gap:10px;margin:0;position:relative;z-index:1}
            .flash-sale-title .icon-bolt{color:#ff4d4f;text-shadow:0 4px 10px rgba(255,77,79,.35)}
            .flash-sale-title-text{font-weight:900;letter-spacing:1px;font-size:clamp(20px,4vw,28px);background:linear-gradient(90deg,#ff4d4f 0%,#ff9aa2 100%);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 2px 8px rgba(255,77,79,.25);}
            .flash-sale-badges{display:flex;flex-wrap:wrap;gap:8px}
            .fs-pill{background:#fff;border:1px solid #ffe1e1;color:#ff4d4f;border-radius:999px;padding:6px 10px;font-weight:600;font-size:12px}
            .fs-viewall{text-align:center;margin:-6px 0 10px;position:relative;z-index:1}
            .fs-viewall .btn{border-radius:999px;padding:8px 16px;font-weight:700;border:1px solid #ff4d4f;color:#ff4d4f;background:#fff;box-shadow:0 6px 16px rgba(255,77,79,.15)}
            .fs-viewall .btn:hover{background:#ff4d4f;color:#fff}
            .fs-info{display:flex;flex-wrap:wrap;gap:12px;margin:12px 0 6px;position:relative;z-index:1;justify-content: center;}
            .fs-info .item{display:flex;align-items:center;gap:6px;color:#6b7280;font-size:12px}
            .fs-info .item i{color:#22c55e}
            .flash-sale-header .timer{margin:0;position:relative;z-index:1}
            .flash-sale-wrapper .time-pill{background:linear-gradient(135deg,rgba(255,255,255,.7),rgba(255,255,255,.45));backdrop-filter:blur(6px);border:1px solid rgba(255,77,79,.15);border-radius:12px;padding:10px 12px;min-width:72px;box-shadow:0 8px 20px rgba(255,77,79,.12);text-align:center}
            .flash-sale-wrapper .time-pill .count{font-weight:800;font-size:22px;color:#ff4d4f;line-height:1}
            .flash-sale-wrapper .time-pill .label{font-size:10px;letter-spacing:.5px;color:#6b7280;margin-top:4px;text-transform:uppercase}
            @media (max-width:576px){
                .flash-sale-wrapper .time-pill{min-width:60px;padding:8px 10px}
                .flash-sale-wrapper .time-pill .count{font-size:18px}
            }
            .flash-sale-wrapper .homepage-products{position:relative;z-index:1}
            @media (max-width:576px){.flash-sale-wrapper{padding:14px 10px}.fs-pill{font-size:11px;padding:5px 8px}.fs-info{gap:8px}}
            @media (max-width:576px){
                .flash-sale-wrapper{padding:14px 10px 12px}
                .flash-sale-ribbon{top:10px;left:-28px;transform:rotate(-28deg);font-size:10px;padding:4px 40px;display:none}
                .flash-sale-header{flex-direction:column;align-items:center;gap:8px;margin-bottom:12px}
                .flash-sale-title-text{font-size:22px}
                .flash-sale-header .timer{order:2;margin-top:2px}
                .flash-sale-badges{justify-content:center}
                .fs-pill{font-size:11px;padding:5px 8px}
                .flash-sale-wrapper .time-pill{min-width:56px;padding:6px 8px}
                .flash-sale-wrapper .time-pill .count{font-size:16px}
                .fs-viewall{margin:8px 0 6px}
            }
        </style>
        <div class="flash-sale-wrapper">
            <div class="flash-sale-ribbon">GIÁ SỐC HÔM NAY</div>
            <div class="flash-sale-header">
                <div></div>
                <h3 class="flash-sale-title"><i class="fas fa-bolt icon-bolt"></i><span class="flash-sale-title-text">FLASH SALE</span></h3>
                <div class="timer">
                    <div class="time-pill">
                        <span class="count countdown-number">00</span>
                        <div class="label">NGÀY</div>
                    </div>
                    <div class="time-pill">
                        <span class="count countdown-number">00</span>
                        <div class="label">GIỜ</div>
                    </div>
                    <div class="time-pill">
                        <span class="count countdown-number">00</span>
                        <div class="label">PHÚT</div>
                    </div>
                    <div class="time-pill">
                        <span class="count countdown-number">00</span>
                        <div class="label">GIÂY</div>
                    </div>
                </div>
                <div class="flash-sale-badges">
                    <span class="fs-pill"><i class="fas fa-clock me-1"></i>Mỗi ngày</span>
                    <span class="fs-pill"><i class="fas fa-shield-alt me-1"></i>Chính hãng</span>
                    <span class="fs-pill"><i class="fas fa-rotate me-1"></i>Đổi trả 5 ngày</span>
                </div>
            </div>

            
            <!-- Products -->
            <div class="row g-3 homepage-products" id="flash-sale-products"></div>
            <div class="fs-viewall" style="margin-top: 12px;">
    <a id="flashSaleLink" href="/products" class="btn">Xem tất cả sản phẩm FLASH SALE</a>
</div>

            <!-- Countdown -->
     <div class="fs-info">
        <div class="item"><i class="fas fa-check-circle"></i><span>Cam kết hàng auth</span></div>
        <div class="item"><i class="fas fa-truck-fast"></i><span>Giao nhanh TP.HCM 4–8h</span></div>
        <div class="item"><i class="fas fa-coins"></i><span>Tiết kiệm đến 90%</span></div>
    </div>
        </div> 
    </div>
    
</section>

<!-- Brands Section -->


<!-- Categories Section -->
<section class="categories-section section-padding">
    <div class="container">
        <style>
            .most-search-title { text-transform: uppercase; font-weight: 800; letter-spacing: .5px; color: #222; }
            .search-tags { gap: 16px; }
            .search-pill { display: inline-block; padding: 5px 20px; border-radius: 999px; background: #f2f3f5; color: #1f2937; font-weight: 600; text-decoration: none; box-shadow: 0 1px 2px rgba(0,0,0,.05); transition: all .2s ease; }
            .search-pill:hover { background: #e9ecef; transform: translateY(-1px); box-shadow: 0 6px 16px rgba(0,0,0,.08); }
            @media (max-width: 576px) { .search-pill { padding: 8px 14px; font-weight: 600; } }
        </style>
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h3 class="most-search-title">Tìm kiếm nhiều nhất</h3>
            </div>
        </div>
        <div class="d-flex flex-wrap justify-content-center search-tags">
            <a href="/products?query=Vitamin%20C%20serum" class="search-pill">Vitamin C serum</a>
            <a href="/products?query=Nuoc%20hoa" class="search-pill">Nước hoa</a>
            <a href="/products?query=Zo" class="search-pill">Zo</a>
            <a href="/products?query=m%E1%BA%B7t%20n%E1%BA%A1" class="search-pill">mặt nạ</a>
            <a href="/products?query=Kem%20ch%E1%BB%91ng%20n%E1%BA%AFng" class="search-pill">Kem chống nắng</a>
            <a href="/products?query=cushion" class="search-pill">cushion</a>
            <a href="/products?query=rice%20water%20bright" class="search-pill">rice water bright</a>
            <a href="/products?query=obagi" class="search-pill">obgai</a>
            <a href="/products?query=Ch%E1%BB%91ng%20l%C3%A3o%20h%C3%B3a" class="search-pill">Chống lão hóa</a>
            <a href="/products?query=freshian" class="search-pill">freshian</a>
            <a href="/products?query=T%E1%BA%A9y%20trang" class="search-pill">Tẩy trang</a>
            <a href="/products?query=Mat%20na%20dat%20set" class="search-pill">Mặt nạ đất sét</a>
            <a href="/products?query=son%20d%C6%B0%E1%BB%A1ng%20c%C3%B3%20m%C3%A0u" class="search-pill">son dưỡng có màu</a>
        </div>
    </div>
</section>

<!-- New Product Section -->
<section id="products" class="new-product section-padding">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h3 class="fw-bold text-primary">Sản Phẩm Mới Về</h3>
                <p class="text-muted">Những sản phẩm mới được cập nhật</p>
                
            </div>
        </div>
        <div class="row g-3 homepage-products" id="new-product-products" style="padding-top: 10px !important;">
                    </div>
    </div>
</section>

<!-- Featured Products -->
<section class="featured-products py-5">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="fw-bold">Sản Phẩm Nổi Bật</h2>
                <p class="text-muted">Những sản phẩm được yêu thích nhất</p>
            </div>
        </div>
        <div id="featured-products-container">
            <!-- Sản phẩm sẽ được load động từ PythonAnywhere -->
        </div>
    </div>
</section>


<!-- Stats Section -->
<section class="stats-section section-padding bg-dark text-white">
    <div class="container">
        <div class="row g-3 text-center">
            <div class="col-lg-3 col-md-6">
                <div class="stat-item">
                    <div class="stat-number display-4 fw-bold text-primary mb-2">8,400+</div>
                    <div class="stat-label">Khách hàng hài lòng</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-item">
                    <div class="stat-number display-4 fw-bold text-primary mb-2">300+</div>
                    <div class="stat-label">Sản phẩm đa dạng</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-item">
                    <div class="stat-number display-4 fw-bold text-primary mb-2">63</div>
                    <div class="stat-label">Tỉnh thành phục vụ</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-item">
                    <div class="stat-number display-4 fw-bold text-primary mb-2">24/7</div>
                    <div class="stat-label">Hỗ trợ khách hàng</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Testimonials Section -->
<section class="testimonials-section section-padding">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h3 class="fw-bold">Khách Hàng Nói Gì</h3>
                <p class="text-muted">Những đánh giá từ khách hàng của chúng tôi</p>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-lg-4">
                <div class="testimonial-card card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <img src="{{ url_for('static', filename='image/khach/gai-xinh-cute-anh-dai-dien-dep-cho-nu-2.jpg') }}" alt="Khách hàng" class="rounded-circle" style="width:80px;height:80px;object-fit:cover;">
                        </div>
                        <h6 class="fw-bold">Nguyễn Thị Anh</h6>
                        <div class="stars text-warning mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="text-muted">"Sản phẩm chất lượng tốt, giá cả hợp lý. Giao hàng online nhanh và đóng gói cẩn thận. Sẽ mua lại!"</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="testimonial-card card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <img src="{{ url_for('static', filename='image/khach/anh-avatar-nam-ca-tinh-nguoi-that.jpg') }}" alt="Khách hàng" class="rounded-circle" style="width:80px;height:80px;object-fit:cover;">
                        </div>
                        <h6 class="fw-bold">Trần Văn Bình</h6>
                        <div class="stars text-warning mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="text-muted">"Shop rất nhiệt tình, tư vấn đúng nhu cầu. Sẽ giới thiệu cho bạn bè!"</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="testimonial-card card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <img src="{{ url_for('static', filename='image/khach/img20171211150728496.jpg') }}" alt="Khách hàng" class="rounded-circle" style="width:80px;height:80px;object-fit:cover;">
                        </div>
                        <h6 class="fw-bold">Phạm Thu Trang</h6>
                        <div class="stars text-warning mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="text-muted">"Giá rẻ hơn nhiều so với mua mới, hàng vẫn còn rất tốt. Rất hài lòng!"</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- Features Section -->
<section class="features-section section-padding bg-primary text-white">
    <div class="container">
        <style>
            .feature-card{background:rgba(221, 221, 221, 0.642);border-radius:14px}
            .feature-icon i{font-size:28px}
            .feature-card p{margin:0;opacity:.9}
        </style>
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h3 class="fw-bold">Tại Sao Chọn BuddySkincare?</h3>
                <p class="mb-0 small">Nhanh hơn, tiết kiệm hơn, chăm sóc tận tâm</p>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-3">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h6 class="mb-1">Đổi trả 5 ngày</h6>
                    <p class="small">An tâm mua sắm</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-3">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-truck"></i>
                    </div>
                    <h6 class="mb-1">Giao nhanh toàn quốc</h6>
                    <p class="small">Hỗ trợ COD</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-3">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <h6 class="mb-1">Giá tốt – Tiết kiệm</h6>
                    <p class="small">Lên đến 80%</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="feature-card text-center p-3">
                    <div class="feature-icon mb-2">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h6 class="mb-1">Tư vấn 24/7</h6>
                    <p class="small">Thân thiện – tận tâm</p>
                </div>
            </div>
        </div>
    </div>
</section>



<!-- Blog Section -->
<section class="blog-section section-padding bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h3 class="fw-bold text-primary">Blog Làm Đẹp</h3>
                <p class="text-muted">Những bài viết hữu ích về chăm sóc da và làm đẹp</p>
            </div>
        </div>
        <!-- Loading state -->
        <div id="blogLoadingState" class="row g-3">
            <div class="col-12 text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p class="mt-3 text-muted">Đang tải bài viết...</p>
            </div>
        </div>

        <!-- Blog posts container -->
        <div id="blogPostsContainer" class="row g-3" style="display: none;">
            <!-- Blog posts will be loaded here -->
        </div>
        <div class="row mt-3">
            <div class="col-12 text-center">
                <a href="/news" class="btn btn-primary">Xem tất cả bài viết</a>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
// Load blog posts for homepage
async function loadHomepageBlogPosts() {
    const loadingState = document.getElementById('blogLoadingState');
    const postsContainer = document.getElementById('blogPostsContainer');
    
    try {
        // Load all posts without pagination
        const response = await fetch('https://buddyskincare.pythonanywhere.com/blog/');
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        let posts = data.results || data;
        
        // If there are multiple pages, load all of them
        if (data.next) {
            console.log('🔍 Loading all blog posts for homepage...');
            let allPosts = [...posts];
            let nextUrl = data.next;
            
            while (nextUrl) {
                try {
                    const nextResponse = await fetch(nextUrl);
                    if (nextResponse.ok) {
                        const nextData = await nextResponse.json();
                        allPosts = [...allPosts, ...(nextData.results || [])];
                        nextUrl = nextData.next;
                    } else {
                        break;
                    }
                } catch (error) {
                    console.error('Error loading additional page:', error);
                    break;
                }
            }
            
            posts = allPosts;
        }
        
        // Show only first 3 posts on homepage
        const displayPosts = posts.slice(0, 3);
        
        if (displayPosts.length > 0) {
            renderHomepageBlogPosts(displayPosts);
            loadingState.style.display = 'none';
            postsContainer.style.display = 'flex';
        } else {
            showHomepageBlogError();
        }
        
    } catch (error) {
        console.error('Error loading homepage blog posts:', error);
        showHomepageBlogError();
    }
}

// Render blog posts for homepage
function renderHomepageBlogPosts(posts) {
    const container = document.getElementById('blogPostsContainer');
    
    const postsHTML = posts.map(post => {
        const imageUrl = post.img_thumbnail || '/static/image/default-blog.jpg';
        const postDate = formatBlogDate(post.post_date);
        const excerpt = truncateBlogText(post.short_description, 100);
        
        return `
            <div class="col-lg-4 col-md-6">
                <div class="blog-card card border-0 shadow-sm h-100">
                    <img src="${imageUrl}" class="card-img-top" alt="${post.title}" 
                         style="height: 200px; object-fit: cover;"
                         onerror="this.src='/static/image/default-blog.jpg'">
                    <div class="card-body">
                        <div class="blog-meta text-muted small mb-2">
                            <i class="fas fa-calendar me-2"></i>${postDate}
                            <i class="fas fa-user ms-3 me-2"></i>BuddySkincare
                        </div>
                        <h5 class="card-title">${post.title}</h5>
                        <p class="card-text text-muted">${excerpt}</p>
                        <a href="/blog/${post.id}" class="btn btn-outline-primary btn-sm">Đọc thêm</a>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    container.innerHTML = postsHTML;
}

// Show error state for homepage blog
function showHomepageBlogError() {
    const loadingState = document.getElementById('blogLoadingState');
    const postsContainer = document.getElementById('blogPostsContainer');
    
    loadingState.style.display = 'none';
    postsContainer.style.display = 'flex';
    postsContainer.innerHTML = `
        <div class="col-12 text-center py-4">
            <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
            <p class="text-muted">Không thể tải bài viết. Vui lòng thử lại sau.</p>
        </div>
    `;
}

// Format blog date
function formatBlogDate(dateString) {
    try {
        const date = new Date(dateString);
        return date.toLocaleDateString('vi-VN', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
    } catch (error) {
        return 'Không rõ ngày';
    }
}

// Truncate blog text
function truncateBlogText(text, maxLength) {
    if (!text) return 'Nội dung đang được cập nhật...';
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength).trim() + '...';
}

// Load blog posts when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadHomepageBlogPosts();
});
</script>
{% endblock %}