{% extends "base.html" %}

{% block title %}T∆∞ V·∫•n Tr·ª±c Ti·∫øp - BuddySkincare{% endblock %}

{% block extra_css %}
<style>
    body {
        background: #f7f9fc;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        color: #333;
        line-height: 1.6;
    }
    
    .chat-main {
        max-width: 900px;
        margin: 20px auto;
        padding: 0 40px;
        height: calc(100vh - 40px);
        display: flex;
        flex-direction: column;
    }

    .chat {
        display: flex;
        flex-direction: column;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        flex-grow: 1;
        overflow: hidden;
    }

    .chat-header {
        padding: 1.2rem 1.5rem;
        border-bottom: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-shrink: 0;
    }
    
    .chat-header .logo-large {
        width: 60px;
        height: 60px;
        object-fit: contain;
        border-radius: 50%;
    }
    
    .chat-title {
        font-weight: 800;
        font-size: 1.2rem;
    }
    
    .time {
        font-size: 0.8rem;
        color: #999;
    }

    #chatBody {
        flex-grow: 1;
        padding: 1.5rem;
        overflow-y: auto;
        background: #fdfdfd;
        display: flex;
        flex-direction: column;
        justify-content: flex-end; 
    }

    .msg {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
        max-width: 80%;
    }
    
    .msg.agent {
        margin-right: auto;
        flex-direction: row;
    }
    
    .msg.user {
        margin-left: auto;
        flex-direction: row-reverse;
    }
    
    .msg .bubble {
        padding: 0.8rem 1.2rem;
        border-radius: 20px;
        font-size: 1rem;
        line-height: 1.5;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        position: relative;
    }
    
    .msg.agent .bubble {
        background-color: #e0e0e0;
        color: #333;
        border-bottom-left-radius: 5px;
        margin-left: 0.8rem;
    }
    
    .msg.user .bubble {
        background: linear-gradient(to right, #6a67fe, #968af2);
        color: #fff;
        border-bottom-right-radius: 5px;
        margin-right: 0.8rem;
    }
    
    .msg .avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
    }
    
    .msg .msg-details {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .msg.user .msg-details {
        align-items: flex-end;
    }
    
    .msg.agent .msg-details {
        align-items: flex-start;
    }

    .chat-composer {
        position: relative;
        border-top: 1px solid #eee;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 10px;
        flex-shrink: 0;
    }
    
    .icon-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: none;
        background: transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #666;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1.5rem;
    }
    
    .icon-btn:hover {
        color: #6a67fe;
    }
    
    .chat-input {
        flex-grow: 1;
        border: 1px solid #ddd;
        background: #f9f9f9;
        border-radius: 20px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: border-color 0.2s ease;
    }
    
    .chat-input:focus {
        outline: none;
        border-color: #6a67fe;
        background: #fff;
    }
    
    .send-btn {
        background: #6a67fe;
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
    }
    
    .send-btn:hover:enabled {
        background: #5c59e9;
    }
    
    .send-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .emoji-panel {
        position: absolute;
        bottom: 70px;
        left: 20px;
        background: #fff;
        border: 1px solid #eee;
        border-radius: 12px;
        padding: 10px;
        display: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        z-index: 10;
    }
    
    .emoji-grid {
        display: grid;
        grid-template-columns: repeat(8, 30px);
        gap: 8px;
    }
    
    .emoji-btn {
        width: 30px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    
    .emoji-btn:hover {
        background: #f0f2f5;
    }
    
    @media (max-width: 900px) {
        .chat-main {
            padding: 0 20px;
            height: calc(100vh - 20px);
        }
        .chat-layout {
            flex-direction: column;
            align-items: center;
        }
        .chat {
            width: 100%;
            height: 90vh;
        }
    }
</style>
{% endblock %}

{% block content %}
<main class="chat-main">
    <section class="chat" aria-live="polite">
        <header class="chat-header">
            <img src="{{ url_for('static', filename='image/logo.png') }}" alt="BuddySkincare" class="logo-large">
            <div>
                <div class="chat-title">H·ªó tr·ª£ BuddySkincare</div>
                <div class="time">Tr·ª±c tuy·∫øn</div>
            </div>
        </header>

        <div id="chatContent" style="display: none; height: 100%; display: flex; flex-direction: column;">
            <div id="chatBody" class="chat-body">
            </div>
            <form id="composer" class="chat-composer" autocomplete="off">
                <button id="emojiBtn" type="button" class="icon-btn" title="Ch√®n emoji"><i class="far fa-smile"></i></button>
                <button id="attachBtn" type="button" class="icon-btn" title="ƒê√≠nh k√®m ·∫£nh"><i class="fas fa-paperclip"></i></button>
                <input id="attachInput" type="file" accept="image/*" hidden>
                <input id="messageInput" class="chat-input" type="text" placeholder="Nh·∫≠p tin nh·∫Øn..." required>
                <button id="sendBtn" class="send-btn" type="submit">G·ª≠i</button>
                <div id="emojiPanel" class="emoji-panel">
                    <div class="emoji-grid">
                        <div class="emoji-btn">üòÄ</div>
                        <div class="emoji-btn">üòÅ</div>
                        <div class="emoji-btn">üòÇ</div>
                        <div class="emoji-btn">üòä</div>
                        <div class="emoji-btn">üòç</div>
                        <div class="emoji-btn">üòé</div>
                        <div class="emoji-btn">üëç</div>
                        <div class="emoji-btn">üôè</div>
                        <div class="emoji-btn">üéâ</div>
                        <div class="emoji-btn">üíñ</div>
                        <div class="emoji-btn">üî•</div>
                        <div class="emoji-btn">‚ú®</div>
                        <div class="emoji-btn">üõçÔ∏è</div>
                        <div class="emoji-btn">üöö</div>
                        <div class="emoji-btn">üí≥</div>
                        <div class="emoji-btn">üß¥</div>
                    </div>
                </div>
            </form>
        </div>

        <div id="loginPrompt" class="login-prompt">
            B·∫°n c·∫ßn <a href="{{ url_for('index') }}">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng t∆∞ v·∫•n tr·ª±c ti·∫øp.
        </div>
    </section>
</main>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="{{ url_for('static', filename='js/auth.js') }}"></script>
<script src="{{ url_for('static', filename='js/live-chat.js') }}"></script>
{% endblock %}