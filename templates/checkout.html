{% extends "base.html" %}

{% block title %}Thanh Toán - BuddySkincare{% endblock %}

{% block content %}
<style>
    /* Custom voucher close button styling */
    .voucher-close-btn {
        background: white !important;
        border: 1px solid #dc3545 !important;
        color: #dc3545 !important;
        border-radius: 50% !important;
        width: 18px !important;
        height: 18px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 12px !important;
        font-weight: bold !important;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2) !important;
        transition: all 0.2s ease !important;
        z-index: 10 !important;
        top: -8px !important;
        right: -8px !important;
        cursor: pointer !important;
        padding: 0 !important;
    }
    
    .voucher-close-btn:hover {
        background: #dc3545 !important;
        color: white !important;
        /* transform: scale(1.1) !important; */
        box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3) !important;
    }
    
    /* Hide Bootstrap's default close button */
    .btn-close::before,
    .btn-close::after {
        display: none !important;
    }
    
    /* Improve voucher alert styling */
    .alert-success {
        border-left: 4px solid #198754 !important;
        background: linear-gradient(135deg, #d1e7dd 0%, #c3e6cb 100%) !important;
        padding: 12px !important;
    }
    
    /* Bank transfer instructions styling */
    .bank-transfer-note {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
        border-left: 4px solid #ffc107 !important;
        border-radius: 8px !important;
        padding: 12px !important;
        margin-top: 8px !important;
    }
    
    .bank-transfer-note .text-warning {
        color: #5d4000 !important;
        font-weight: 500 !important;
    }
    
    /* Suggested products styling */
    .suggested-products-title {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%) !important;
        -webkit-background-clip: text !important;
        -webkit-text-fill-color: transparent !important;
        background-clip: text !important;
    }
    
    .suggested-product-card {
        transition: all 0.3s ease !important;
        border: 1px solid #e9ecef !important;
        min-height: 150px !important;
    }
    
    .suggested-product-card:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
        border-color: #ff6b6b !important;
    }
    
    .flash-sale-badge {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24) !important;
        color: white !important;
        font-weight: bold !important;
        font-size: 8px !important;
        padding: 2px 5px !important;
        border-radius: 8px !important;
        position: absolute !important;
        top: 4px !important;
        left: 4px !important;
        z-index: 5 !important;
    }
    
    /* Responsive adjustments for tablet (3-4 products per row) */
    @media (max-width: 991px) {
        .suggested-product-card {
            min-height: 180px !important;
            height: 180px !important;
            max-height: 180px !important;
        }
        
        .suggested-product-card .card-title {
            font-size: 10px !important;
            height: 12px !important;
            line-height: 12px !important;
        }
        
        .suggested-product-card img {
            height: 100px !important;
        }
        
        /* Only affect the main product image, not the logo */
        .suggested-product-card .suggested-product-image {
            height: 100px !important;
        }
        
        .suggested-product-card .card-body {
            padding: 8px !important;
        }
    }
    
    /* Responsive adjustments for small mobile (2 products per row) */
    @media (max-width: 576px) {
        .suggested-product-card {
            min-height: 160px !important;
            height: 160px !important;
            max-height: 160px !important;
        }
        
        .suggested-product-card .card-title {
            font-size: 9px !important;
            height: 11px !important;
            line-height: 11px !important;
        }
        
        .suggested-product-card .flash-sale-badge {
            font-size: 8px !important;
            padding: 2px 5px !important;
        }
        
        .suggested-product-card img {
            height: 140px !important;
        }
        
        .suggested-product-card .card-body {
            padding: 6px !important;
        }
        .product-logo img{
            height: 24px !important;
        }
    }
    
    /* Empty product slot styling */
    .empty-product-slot {
        background: #f8f9fa !important;
        border: 1px dashed #dee2e6 !important;
    }
    
    .empty-product-slot:hover {
        transform: none !important;
        box-shadow: none !important;
        border-color: #dee2e6 !important;
    }
    
    .empty-image-placeholder {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
        border: 1px dashed #dee2e6 !important;
    }
    
    .empty-text-placeholder {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
        border: 1px dashed #dee2e6 !important;
    }
    
    /* Fixed dimensions for all suggested product cards */
    .suggested-product-card {
        width: 100% !important;
        height: 230px !important;
        min-height: 230px !important;
        max-height: 230px !important;
    }
    
    /* Ensure equal column widths */
    #checkout-suggested-products .col-6.col-lg {
        flex: 1 1 0 !important;
        min-width: 0 !important;
        max-width: 20% !important;
    }
    
    /* Grid container styling */
    #checkout-suggested-products .row {
        display: flex !important;
        flex-wrap: nowrap !important;
        margin: 0 !important;
    }
    
    #checkout-suggested-products .col-6.col-lg {
        flex: 1 1 0 !important;
        padding: 0 4px !important;
        margin: 0 !important;
    }
    
    /* Mobile responsive: 2 products per row */
    @media (max-width: 767px) {
        #checkout-suggested-products .col-6.col-lg {
            flex: 0 0 50% !important;
            max-width: 50% !important;
        }
        
        #checkout-suggested-products .row {
            flex-wrap: wrap !important;
        }
        
        /* Adjust card sizing for mobile */
        .suggested-product-card {
            height: 210px !important;
            min-height: 210px !important;
            max-height: 210px !important;
            margin-bottom: 10px !important;
        }
        
        /* Only affect the main product image, not the logo */
        .suggested-product-card .suggested-product-image {
            height: 140px ;
        }
        
        .suggested-product-card .card-body {
            padding: 6px !important;
        }
        
        .suggested-product-card .card-title {
            font-size: 8px !important;
            height: 10px !important;
            line-height: 10px !important;
        }
        
        .suggested-product-card .flash-sale-badge {
            font-size: 7px !important;
            padding: 1px 4px !important;
        }
    }
    
    /* Tablet responsive: 3-4 products per row */
    @media (min-width: 768px) and (max-width: 991px) {
        #checkout-suggested-products .col-6.col-lg {
            flex: 0 0 33.333% !important;
            max-width: 33.333% !important;
        }
        
        #checkout-suggested-products .row {
            flex-wrap: wrap !important;
        }
        
        /* Adjust card sizing for tablet */
        .suggested-product-card {
            height: 210px !important;
            min-height: 210px !important;
            max-height: 210px !important;
        }
        
        .suggested-product-card img {
            height: 140px ;
        }
        
        /* Only affect the main product image, not the logo */
        .suggested-product-card .suggested-product-image {
            height: 140px ;
        }
        
        .suggested-product-card .card-body {
            padding: 8px !important;
        }
        
        .suggested-product-card .card-title {
            font-size: 9px !important;
            height: 11px !important;
            line-height: 11px !important;
        }
        
        .suggested-product-card .flash-sale-badge {
            font-size: 8px !important;
            padding: 2px 6px !important;
        }
    }
    
    /* Desktop responsive: 5 products per row */
    @media (min-width: 992px) {
        #checkout-suggested-products .col-6.col-lg {
            flex: 1 1 0 !important;
            max-width: 20% !important;
        }
        
        #checkout-suggested-products .row {
            flex-wrap: nowrap !important;
        }
    }
    
    /* Product title styling for single line */
    .suggested-product-card .card-title {
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        height: 11px !important;
        line-height: 11px !important;
        max-width: 100% !important;
        width: 100% !important;
    }
    
    /* Prevent text from affecting card dimensions */
    .suggested-product-card .card-body {
        overflow: hidden !important;
        word-wrap: break-word !important;
    }
    
    /* Add to cart button styling for suggested products */
    .suggested-product-card .add-to-cart-btn {
        transition: all 0.3s ease !important;
        border-radius: 4px !important;
        min-width: 24px !important;
        height: 20px !important;
    }
    
    .suggested-product-card .add-to-cart-btn:hover {
        background-color: #007bff !important;
        color: white !important;
        transform: scale(1.1) !important;
    }
    
    .suggested-product-card .add-to-cart-btn:active {
        transform: scale(0.95) !important;
    }
    
    .suggested-product-card .add-to-cart-btn:disabled {
        opacity: 0.6 !important;
        cursor: not-allowed !important;
    }
    
    /* Ensure content doesn't overlap with close button */
    .pe-4 {
        padding-right: 2rem !important;
    }
</style>
<section class="page-header bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Trang chủ</a></li>
                        <li class="breadcrumb-item"><a href="/cart" class="text-decoration-none">Giỏ hàng</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Thanh toán</li>
                    </ol>
                </nav>
                <h1 class="fw-bold mt-3">Thanh Toán</h1>
                <p class="text-muted">Nhập thông tin và hoàn tất đơn hàng của bạn</p>
            </div>
        </div>
    </div>
</section>

<section class="py-4">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card border-0 shadow mb-3">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">Thông Tin Khách Hàng</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input id="fullName" name="fullName" type="text" class="form-control checkout-required" placeholder="Nhập tên" required>
                            </div>
                            <div class="col-md-6">
                                <input id="phone" name="phone" type="tel" class="form-control checkout-required" placeholder="Nhập số điện thoại" required>
                            </div>
                            <div class="col-md-6">
                                <input id="email" name="email" type="email" class="form-control" placeholder="Nhập email">
                            </div>
                
                            <div class="col-md-6">
                                <input id="city" name="city" type="text" class="form-control checkout-required" placeholder="Nhập tỉnh/thành" required>
                            </div>
                            <div class="col-12">
                                <input id="shippingAddress" name="shippingAddress" type="text" class="form-control checkout-required" placeholder="Số nhà, đường, phường/xã, quận/huyện" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Ghi chú</label>
                                <textarea id="orderNote" name="orderNote" class="form-control" rows="3" placeholder="Ghi chú cho đơn hàng (tuỳ chọn)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow mb-3">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">Phương Thức Vận Chuyển</h5>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="ship" id="ship1" checked>
                            <label class="form-check-label" for="ship1">Giao tiêu chuẩn (2-6 ngày) - 30.000đ</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="ship" id="ship2">
                            <label class="form-check-label" for="ship2">Giao nhanh đối với TP.HCM (4h-8h) - 40.000đ</label>
                        </div>
                    </div>
                </div>

                <!-- Suggested Products Section -->
                <div class="card border-0 shadow mb-3">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3 suggested-products-title">
                            <i class="fas fa-fire text-danger me-2"></i>
                            Sản Phẩm Gợi Ý Đang Giảm Mạnh
                        </h5>
                        <p class="text-muted small mb-3">Khám phá thêm các sản phẩm flash-sale hấp dẫn! </p>
                        
                        <!-- Flash Sale Products Container -->
                        <div id="checkout-suggested-products">
                            <!-- Loading state -->
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Đang tải...</span>
                                </div>
                                <p class="text-muted mt-2">Đang tải sản phẩm gợi ý...</p>
                            </div>
                        </div>
                        
                        <!-- View All Products Button -->
                        <div class="text-center mt-3">
                            <a href="/products" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-eye me-2"></i>Xem tất cả sản phẩm
                            </a>
                        </div>
                    </div>
                </div>
                
               
                
            </div>

            <div class="col-lg-4">
                <div class="card border-0 shadow">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">Tóm Tắt Đơn Hàng</h5><hr>
                        
                        <!-- Cart items will be loaded here by JavaScript -->
                        <div id="checkout-items-container">
                            <!-- Loading state -->
                            <div class="text-center py-3">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="text-muted small mt-2">Đang tải...</p>
                            </div>
                        </div>

                        <hr>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Tạm tính</span>
                            <span class="checkout-subtotal">0đ</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Phí vận chuyển</span>
                            <span class="checkout-shipping">0đ</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2" id="checkoutVoucherLine" style="display: none !important;">
                            <span class="text-success">Mã giảm giá</span>
                            <span class="text-success checkout-voucher-discount">-0đ</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-success fw-semibold"><i class="fas fa-piggy-bank me-1"></i>Tiết kiệm được</span>
                            <span class="text-success fw-semibold checkout-savings">0đ</span>
                        </div>
                        <div class="text-muted small mb-2" style="font-size: 10px; font-style: italic;">
                            <i class="fas fa-info-circle me-1"></i>Tiết kiệm gồm: Giá gốc + Voucher + Giảm phí ship
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">Tổng cộng</span>
                            <span class="fs-5 fw-bold text-danger checkout-total">0đ</span>
                        </div>
                       
                                                 <div class="mt-3">
                            <button class="btn btn-primary w-100" id="place-order-btn">Đặt hàng</button>
                        </div>
                        
                        
                    </div>
                </div>
                <div class="card border-0 shadow" style="margin-top: 14px;">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">Phương Thức Thanh Toán</h5>
                        
                        <!-- Payment Method Selection -->
                        <div class="mb-3">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="pay" id="pay1" value="cod">
                                <label class="form-check-label" for="pay1">
                                    <i class="fas fa-wallet me-2 text-success"></i>
                                    <strong>Thanh toán khi nhận hàng (COD)</strong>
                                    <div class="text-muted small">Nhân viên sẽ gọi điện xác nhận trước khi giao hàng</div>
                                </label>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="pay" id="pay2" value="bankTransfer">
                                <label class="form-check-label" for="pay2">
                                    <i class="fas fa-university me-2 text-primary"></i>
                                    <strong>Chuyển khoản ngân hàng</strong>
                                    <div class="text-muted small">Giảm 50% phí vận chuyển</div>
                                </label>
                            </div>
                            
                            
                        </div>
                        
                        <!-- Bank Transfer Information -->
                        <div id="bankTransferSection" class="d-none">
                            <hr class="my-3">
                            <h6 class="fw-bold mb-3 text-primary">
                                <i class="fas fa-university me-2"></i>Thông Tin Chuyển Khoản
                            </h6>
                            
                            <!-- Bank Account Info -->
                            <div class="alert alert-primary py-3 mb-3">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <strong>Ngân hàng:</strong><br>
                                        <span class="text-primary fw-bold">Saccombank</span>
                                    </div>
                                    <div class="col-6">
                                        <strong>Số tài khoản:</strong><br>
                                        <span class="text-primary fw-bold">0701 1991 0003</span>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <strong>Chủ tài khoản:</strong><br>
                                    <span class="text-primary fw-bold">NGUYEN HUU NGHIA</span>
                                </div>
                                <hr class="my-2">
                                <div class=" small">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    <strong>Lưu ý:</strong> Sau khi chuyển khoản xong, vui lòng chụp ảnh lại và tải ảnh vào ô bên dưới sau đó bấm "Đặt hàng" để up ảnh chuyển khoản.
                                </div>
                            </div>
                            <!-- Transfer Amount Display -->
                            <div class="alert alert-success py-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-check-circle me-2"></i>Số tiền cần chuyển:</span>
                                    <span class="fw-bold fs-6 transfer-amount">0đ</span>
                                </div>
                            </div>
                            
                            <!-- QR Code Section -->
                            <div class="text-center mb-3">
                                <img src="{{ url_for('static', filename='image/qr.jpg') }}" alt="QR Code chuyển khoản" class="img-fluid border rounded" style="max-width: 200px;">
                                <div class="text-muted small mt-2">Quét mã QR để chuyển khoản</div>
                            </div>

                             
                            
                            <!-- Upload Transfer Proof -->
                            <div class="mb-3">
                                <label class="form-label fw-semibold">
                                    <i class="fas fa-upload me-2"></i>Upload Ảnh Chuyển Khoản
                                </label>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="transferProof" accept="image/*" required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="document.getElementById('transferProof').click()">
                                        <i class="fas fa-folder-open"></i>
                                    </button>
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    <strong>Bắt buộc:</strong> Vui lòng upload ảnh chụp màn hình hoặc biên lai chuyển khoản để xác nhận thanh toán. Không có ảnh chuyển khoản, đơn hàng sẽ không được xử lý.
                                </div>
                            </div>
                            
                           
                        </div>
                    </div>
                </div>
                <!-- Voucher Section -->
                <div class="mt-3" style="margin-bottom: 14px;">
                    <div class="card border-0 shadow">
                        <div class="card-body p-3">
                            <h6 class="fw-bold mb-2">
                                <i class="fas fa-ticket-alt text-success me-2"></i>Mã Giảm Giá
                            </h6>
                            <div class="input-group">
                                <input type="text" class="form-control" id="checkoutVoucherCode" placeholder="Nhập mã giảm giá" value="">
                                <button class="btn btn-outline-success" type="button" id="applyCheckoutVoucher">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                            <div id="checkoutVoucherMessage" class="mt-2 small"></div>
                            <div id="checkoutVoucherApplied" class="mt-2 d-none">
                                <div class="alert alert-success py-3 mb-0 position-relative">
                                    <!-- Close button - small and properly positioned -->
                                    <button type="button" class="btn-close position-absolute voucher-close-btn" id="removeCheckoutVoucher">
                                        <span aria-hidden="true" style="font-weight: bold;">×</span>
                                    </button>
                                    
                                    <!-- Voucher content -->
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="fw-semibold"><i class="fas fa-check-circle me-2 text-success"></i>Đã áp dụng:</span>
                                        <span class="fw-bold text-success" id="checkoutVoucherName">HIBUDDY</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="text-muted">Giảm giá:</span>
                                        <span class="text-success fw-bold fs-6" id="checkoutVoucherDiscount">-10.000đ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Lưu ý mua hàng -->
 <div class="card border-0 shadow mb-3">
    <div class="card-body">
        <h5 class="fw-bold mb-3">
            <i class="fas fa-info-circle text-warning me-2"></i>Lưu ý khi mua hàng
        </h5>
        <ol class="mb-0 ps-3" style="font-size: 12px; font-style: italic;">
            <li class="mb-2"><strong>Điều Kiện Quan Trọng:</strong> Với đơn hàng thanh lý, BuddySkincare xử lý đổi trả sau <strong>5 ngày</strong> kể từ khi bạn nhận hàng nha. Khi gửi lại, nhớ giúp mình đảm bảo sản phẩm <strong>không bị đổ bể</strong> để đội hỗ trợ kiểm tra nhanh hơn nhé!</li>
            <li class="mb-2"><strong>Đọc Kỹ Thông Tin:</strong> Bạn hãy đọc thật kỹ mô tả sản phẩm trước khi “chốt đơn” nhé. Mình rất tiếc là các trường hợp <strong>không đọc kỹ thông tin</strong> sẽ khó hỗ trợ đổi trả được ạ.</li>
            <li class="mb-2"><strong>Liên Hệ Hỗ Trợ:</strong> Có thắc mắc hay cần tư vấn, bạn cứ <strong>nhắn ngay cho tụi mình</strong> — BuddySkincare luôn sẵn sàng đồng hành để xử lý nhanh gọn, vui vẻ!</li>
            <li class="mb-0"><strong>Lưu ý đối với sản phẩm:</strong> Vì là <strong>mỹ phẩm thanh lý</strong> nên đôi khi vỏ hộp có thể hơi móp nhẹ hoặc dính chút bụi do lưu kho; một số mã còn được <strong>hủy lô</strong> để giữ giá thị trường cho hàng mới nên giá thanh lý luôn <strong>rất dễ thương</strong>. Tụi mình cam kết <strong>hàng auth</strong>, chất lượng bên trong vẫn “xịn xò” để skincare cho bạn thật hiệu quả!</li>
        </ol>
    </div>
</div>
                
            </div>
 
            
            
        </div>
    </div>
</section>
{% endblock %}

