{% extends "base.html" %}

{% block title %}Gi·ªè H√†ng - BuddySkincare{% endblock %}

{% block content %}
<style>
    /* Custom voucher close button styling */
    .voucher-close-btn {
        background: white !important;
        border: 1px solid #dc3545 !important;
        color: #dc3545 !important;
        border-radius: 50% !important;
        width: 18px !important;
        height: 18px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 12px !important;
        font-weight: bold !important;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2) !important;
        transition: all 0.2s ease !important;
        z-index: 10 !important;
        top: -8px !important;
        right: -8px !important;
        cursor: pointer !important;
        padding: 0 !important;
    }
    
    .voucher-close-btn:hover {
        background: #dc3545 !important;
        color: white !important;
        /* transform: scale(1.1) !important; */
        box-shadow: 0 2px 6px rgba(220, 53, 69, 0.3) !important;
    }
    
    /* Hide Bootstrap's default close button */
    .btn-close::before,
    .btn-close::after {
        display: none !important;
    }
    
    /* Improve voucher alert styling */
    .alert-success {
        border-left: 4px solid #198754 !important;
        background: linear-gradient(135deg, #d1e7dd 0%, #c3e6cb 100%) !important;
        padding: 12px !important;
    }
    
    /* Bank transfer instructions styling */
    .bank-transfer-note {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
        border-left: 4px solid #ffc107 !important;
        border-radius: 8px !important;
        padding: 12px !important;
        margin-top: 8px !important;
    }
    
    .bank-transfer-note .text-warning {
        color: #5d4000 !important;
        font-weight: 500 !important;
    }
    
    /* Ensure content doesn't overlap with close button */
    .pe-4 {
        padding-right: 2rem !important;
    }
</style>
<section class="page-header bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Trang ch·ªß</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Gi·ªè h√†ng</li>
                    </ol>
                </nav>
                <h1 class="fw-bold mt-3">Gi·ªè H√†ng C·ªßa B·∫°n</h1>
                <p class="text-muted">Ki·ªÉm tra l·∫°i s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n</p>
            </div>
        </div>
    </div>
</section>

<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-8 ">
                <!-- Cart items will be loaded here by JavaScript -->
                <div id="cart-items-container" >
                    <!-- Loading state -->
                    <div class="card border-0 shadow-md">
                        <div class="card-body text-center py-5">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted">ƒêang t·∫£i gi·ªè h√†ng...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <!-- Cart summary will be updated by JavaScript -->
                <div id="cart-summary-container">
                    <!-- Loading state -->
                    <div class="card border-0 shadow">
                        <div class="card-body">
                            <h5 class="fw-bold mb-3">T√≥m T·∫Øt ƒê∆°n H√†ng</h5><hr>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">T·∫°m t√≠nh</span>
                                <span class="cart-subtotal">0ƒë</span>
                            </div>
                           
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Ph√≠ v·∫≠n chuy·ªÉn</span>
                                <span class="cart-shipping">0ƒë</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2" id="cartVoucherLine" style="display: none !important;">
                                <span class="text-success">M√£ gi·∫£m gi√°</span>
                                <span class="text-success cart-voucher-discount">-0ƒë</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-success fw-semibold"><i class="fas fa-piggy-bank me-1"></i>Ti·∫øt ki·ªám ƒë∆∞·ª£c</span>
                                <span class="text-success fw-semibold cart-savings">0ƒë</span>
                            </div>
                            <div class="text-muted small  mb-2" style="font-size: 10px; font-style: italic;">
                                <i class="fas fa-info-circle me-1"></i>Ti·∫øt ki·ªám g·ªìm: Gi√° g·ªëc + Voucher + Gi·∫£m ph√≠ ship
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="fw-bold">T·ªïng c·ªông</span>
                                <span class="fs-5 fw-bold text-danger cart-total">0ƒë</span>
                            </div>
                            
                            <!-- Payment Method Selection -->
                            <hr class="my-3">
                            <h6 class="fw-bold mb-3">Ph∆∞∆°ng Th·ª©c Thanh To√°n</h6>
                            <div class="mb-3">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" checked>
                                    <label class="form-check-label" for="cod">
                                        <i class="fas fa-money-bill-wave text-success me-2"></i>
                                        <strong>Ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng (COD)</strong>
                                        <div class="text-muted small">Nh√¢n vi√™n s·∫Ω g·ªçi ƒëi·ªán x√°c nh·∫≠n tr∆∞·ªõc khi giao h√†ng</div>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="bankTransfer" value="bankTransfer">
                                    <label class="form-check-label" for="bankTransfer">
                                        <i class="fas fa-university text-primary me-2"></i>
                                        <strong>Chuy·ªÉn kho·∫£n ng√¢n h√†ng</strong>
                                        <div class="text-muted small">Gi·∫£m 50% ph√≠ v·∫≠n chuy·ªÉn</div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Payment Info for Bank Transfer -->
                            <div id="bankTransferInfo" class="d-none">
                                <div class="alert alert-info py-2 px-3 mb-3 small">
                                    <div class="row align-items-center">
                                        <div class="col-8">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <strong>Th√¥ng tin chuy·ªÉn kho·∫£n:</strong><br>
                                            <strong>Ng√¢n h√†ng:</strong> Saccombank<br>
                                            <strong>S·ªë t√†i kho·∫£n:</strong> 0701 1991 0003<br>
                                            <strong>Ch·ªß t√†i kho·∫£n:</strong> NGUYEN HUU NGHIA
                                        </div>
                                        <div class="col-4 text-center">
                                            <img src="{{ url_for('static', filename='image/qr.jpg') }}" alt="QR Code chuy·ªÉn kho·∫£n" class="img-fluid border rounded" style="max-width: 80px; height: auto;">
                                            <div class="text-muted small mt-1">Qu√©t m√£ QR</div>
                                        </div>
                                    </div>
                                    <hr class="my-2">
                                    <div class="text-warning small">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        <strong>L∆∞u √Ω:</strong> Sau khi chuy·ªÉn kho·∫£n xong, vui l√≤ng ch·ª•p ·∫£nh l·∫°i v√† b·∫•m "Thanh to√°n & ƒêi·ªÅn th√¥ng tin" ƒë·ªÉ up ·∫£nh chuy·ªÉn kho·∫£n.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Processing Notice -->
                    <div class="mt-3">
                        <div class="alert alert-info border-0 shadow-sm" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left: 4px solid #2196f3 !important;">
                            <div class="d-flex align-items-start">
                                <div class="me-2">
                                </div>
                                <div>
                                    <h6 class="alert-heading mb-1 text-primary fw-bold small">
                                        <i class="fas fa-heart me-1"></i>Tin nh·∫Øn d·ªÖ th∆∞∆°ng t·ª´ shop üíï
                                    </h6>
                                    <p class="mb-0 small">
                                        Shop m√¨nh ∆∞u ti√™n c√°c b·∫°n chuy·ªÉn kho·∫£n tr∆∞·ªõc nha, v√¨ h√†ng c√≥ h·∫°n ·∫°! Nh√¢n vi√™n s·∫Ω check ƒë∆°n m·ªói 1-2 ti·∫øng ƒë·ªÉ x·ª≠ l√Ω nhanh nh·∫•t c√≥ th·ªÉ. N·∫øu h·∫øt h√†ng th√¨ shop xin l·ªói c√°c b·∫°n nhi·ªÅu l·∫Øm ·∫°! Mong c√°c b·∫°n th√¥ng c·∫£m cho shop nh√© ü•∫
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checkout Button -->
                    <div class="mt-3">
                        <a href="/checkout" class="btn btn-primary w-100" id="checkoutBtn">
                            <i class="fas fa-credit-card me-2"></i>Thanh to√°n & ƒêi·ªÅn th√¥ng tin
                        </a>
                    </div>
                    
                    <!-- Voucher Section -->
                    <div class="mt-3">
                        <div class="card border-0 shadow">
                            <div class="card-body p-3">
                                <h6 class="fw-bold mb-2">
                                    <i class="fas fa-ticket-alt text-success me-2"></i>M√£ Gi·∫£m Gi√°
                                </h6>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="cartVoucherCode" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°" value="">
                                    <button class="btn btn-outline-success" type="button" id="applyCartVoucher">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                                <div id="cartVoucherMessage" class="mt-2 small"></div>
                                <div id="cartVoucherApplied" class="mt-2 d-none">
                                    <div class="alert alert-success py-3 mb-0 position-relative">
                                        <!-- Close button - small and properly positioned -->
                                        <button type="button" class="btn-close position-absolute voucher-close-btn" id="removeCartVoucher">
                                            <span aria-hidden="true" style="font-weight: bold;">√ó</span>
                                        </button>
                                        
                                        <!-- Voucher content -->
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="fw-semibold"><i class="fas fa-check-circle me-2 text-success"></i>ƒê√£ √°p d·ª•ng:</span>
                                            <span class="fw-bold text-success" id="cartVoucherName">HIBUDDY</span>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="text-muted">Gi·∫£m gi√°:</span>
                                            <span class="text-success fw-bold fs-6" id="cartVoucherDiscount">-10.000ƒë</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_modals %}
<!-- Confirm Modal -->
<div class="modal fade" id="cartConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-modern">
            <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            <div class="modal-body text-center p-4">
                <img id="cartSadGif" src="/static/image/gif/khoc.gif" alt="sad" class="mx-auto mb-3" style="width: 96px; height: 96px; object-fit: cover; display: block;">
                <h5 class="fw-bold mb-2">X√≥a s·∫£n ph·∫©m?</h5>
                <p class="text-muted mb-0" id="cartConfirmMessage">B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh·ªèi gi·ªè h√†ng kh√¥ng?</p>
            </div>
            <div class="modal-footer border-0 pt-0 pb-4 d-flex justify-content-center gap-2">
                <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">H·ªßy</button>
                <button type="button" class="btn btn-danger px-4" id="cartConfirmOkBtn">
                    <i class="fa-solid fa-trash-can me-2"></i> X√≥a
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<script>
// Load cart data when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Initialize cart display
    updateCartDisplay();
    
    // Update cart summary
    updateCartSummary();
    
    // Initialize checkout button state
    updateCheckoutButtonState();
});
</script>

